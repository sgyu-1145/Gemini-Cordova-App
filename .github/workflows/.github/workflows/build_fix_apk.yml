name: 🏆 FINAL-SUCCESS-APK-BUILD

on:
  workflow_dispatch: # 允许手动点击触发

jobs:
  build-android-debug:
    runs-on: ubuntu-latest
    
    steps:
    - name: 1. Checkout Code
      uses: actions/checkout@v4

    - name: 2. Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18' 
    
    - name: 3. 结构修复与编译 (FINAL FIX - 一体化)
      run: |
        echo "--- 正在修复文件结构：创建 www 文件夹并移动核心内容 ---"
        # 1. 创建 www 文件夹 (修复 GitHub 网页上传问题)
        mkdir www
        # 2. 移动您的网页文件到 www 文件夹内 (只移动您仓库里已有的文件)
        mv index.html www/
        mv script.js www/
        mv styles.css www/
        
        echo "--- 正在使用 NPX 临时环境安装平台并编译 APK (绕过所有 npm 路径错误) ---"
        # 3. 使用 npx 临时安装 Cordova，并添加 Android 平台
        npx -p cordova@12.0.0 cordova platform add android@12.0.0 --no-telemetry
        
        # 4. 编译 Debug APK
        npx -p cordova@12.0.0 cordova build android --debug --no-telemetry
        
    - name: 4. Upload APK Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Final-APK-Download-Success
        path: platforms/android/app/build/outputs/apk/debug/app-debug.apk
        retention-days: 7
